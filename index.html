<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Unit 3 ‚Äì Present Perfect (Esercizi memoria)</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: rgba(255,255,255,0.08);
      --card2: rgba(255,255,255,0.06);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --ok: rgba(0,255,170,0.85);
      --bad: rgba(255,90,90,0.9);
      --warn: rgba(255,210,80,0.9);
      --line: rgba(255,255,255,0.14);
      --btn: rgba(255,255,255,0.12);
      --btn2: rgba(255,255,255,0.18);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    * { box-sizing: border-box; }
    body{
      margin:0; font-family: var(--sans);
      color: var(--text);
      background: radial-gradient(1200px 700px at 20% 10%, rgba(80,120,255,0.20), transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, rgba(0,255,170,0.14), transparent 55%),
                  radial-gradient(900px 700px at 40% 90%, rgba(255,90,90,0.12), transparent 55%),
                  var(--bg);
      min-height:100vh;
      padding: 22px;
    }
    header{
      max-width: 980px; margin: 0 auto 18px auto;
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    .title{
      background: linear-gradient(135deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 16px 18px;
      box-shadow: var(--shadow);
      flex: 1 1 520px;
    }
    h1 { margin:0 0 8px 0; font-size: 20px; letter-spacing: 0.2px; }
    .subtitle{ color: var(--muted); font-size: 13.5px; line-height:1.35; }
    .panel{
      background: linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 14px 16px;
      box-shadow: var(--shadow);
      min-width: 260px;
      flex: 0 1 320px;
    }
    .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .pill{
      font-family: var(--mono);
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.06);
    }
    .btn{
      border:1px solid var(--line);
      background: var(--btn);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 650;
      transition: 0.15s transform, 0.15s background;
      user-select:none;
    }
    .btn:hover{ background: var(--btn2); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px); }
    main{ max-width: 980px; margin: 0 auto; display:flex; flex-direction:column; gap:14px; }
    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      box-shadow: var(--shadow);
      padding: 16px 18px;
    }
    .card h2{
      margin:0 0 10px 0; font-size: 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .hint{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
      margin: 0 0 10px 0;
    }
    .q{
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      background: rgba(255,255,255,0.05);
      margin: 10px 0;
    }
    .qtitle{ font-weight: 750; margin-bottom:8px; }
    label{ display:block; margin: 7px 0; cursor:pointer; }
    input[type="radio"]{ transform: translateY(1px); margin-right:8px; }
    input[type="text"]{
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,0.18);
      color: var(--text);
      outline: none;
      font-family: var(--sans);
    }
    .grid2{
      display:grid; grid-template-columns: 1fr 1fr; gap: 10px;
    }
    @media (max-width: 720px){
      .grid2{ grid-template-columns: 1fr; }
    }
    .feedback{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      font-size: 13.5px;
      line-height: 1.35;
    }
    .ok{ border-color: rgba(0,255,170,0.35); background: rgba(0,255,170,0.10); }
    .bad{ border-color: rgba(255,90,90,0.35); background: rgba(255,90,90,0.10); }
    .warn{ border-color: rgba(255,210,80,0.35); background: rgba(255,210,80,0.10); }
    .muted{ color: var(--muted); }
    .small{ font-size: 12.5px; }
    .sol{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed var(--line);
      color: rgba(255,255,255,0.86);
      font-family: var(--mono);
      font-size: 12.5px;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    details{
      margin-top: 8px;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.04);
    }
    summary{ cursor:pointer; font-weight: 750; }
  </style>
</head>
<body>
<header>
  <div class="title">
    <h1>Unit 3 ‚Äì Present Perfect (Esercizi per imparare ‚Äúa memoria‚Äù)</h1>
    <div class="subtitle">
      Obiettivo: distinguere <b>Present Perfect</b> vs <b>Simple Past</b>, usare bene <b>have been / have gone</b>,
      <b>ever/never</b>, e collegare esperienze ed emozioni. <br>
      Consiglio: fai 2 giri (1¬∞ lento, 2¬∞ veloce) e prova a spiegare a voce il perch√© di ogni risposta.
    </div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="pill">Punteggio: <span id="score">0</span>/<span id="total">0</span></div>
      <div class="pill">Tentativi: <span id="tries">0</span></div>
    </div>
    <div style="height:10px"></div>
    <div class="row">
      <button class="btn" id="checkAllBtn">Correggi tutto</button>
      <button class="btn" id="resetBtn">Reset</button>
    </div>
    <div style="height:10px"></div>
    <div class="hint small">
      <span class="muted">Tip:</span> se sbagli, leggi la spiegazione e ripeti la regola a voce alta.
    </div>
  </div>
</header>

<main>

  <!-- CARD 1: Quick rules recall -->
  <section class="card" id="card-rules">
    <h2>1) Ripasso lampo (memoria) <span class="pill">11 punti</span></h2>
    <p class="hint">
      Completa: sono frasi ‚Äúregola‚Äù. Scrivi <b>parole chiave</b> (anche brevi).
    </p>

    <div class="grid2">

      <div class="q" data-type="text" data-answer="have/has + past participle" data-points="1">
        <div class="qtitle">1.1 Forma base del Present Perfect:</div>
        <input type="text" placeholder="Es: have/has + ..." />
        <div class="feedback muted">Suggerimento: have/has + ... (V3)</div>
      </div>

      <!-- UPDATED: accept multiple good answers -->
      <div class="q" data-type="text" data-answer="definite time|finished time|a definite time|a finished time|when|specific time" data-points="1">
        <div class="qtitle">1.2 Simple Past: si usa quando dici ____ (la data/il momento).</div>
        <input type="text" placeholder="Es: definite time / when" />
        <div class="feedback muted">Suggerimento: yesterday, last year, in 2022‚Ä¶</div>
      </div>

      <div class="q" data-type="text" data-answer="not finished|unfinished time" data-points="1">
        <div class="qtitle">1.3 Present Perfect: si pu√≤ usare con ‚Äútoday/this week‚Äù se il tempo √® ____.</div>
        <input type="text" placeholder="Es: not finished / unfinished time" />
        <div class="feedback muted">Suggerimento: la settimana/giornata non √® finita.</div>
      </div>

      <div class="q" data-type="text" data-answer="been" data-points="1">
        <div class="qtitle">1.4 ‚ÄúHave ____‚Äù: sono stato e sono tornato.</div>
        <input type="text" placeholder="been / gone ?" />
        <div class="feedback muted">Suggerimento: London ‚Üí andato e tornato.</div>
      </div>

      <div class="q" data-type="text" data-answer="gone" data-points="1">
        <div class="qtitle">1.5 ‚ÄúHave ____‚Äù: √® andato ed √® ancora l√¨.</div>
        <input type="text" placeholder="been / gone ?" />
        <div class="feedback muted">Suggerimento: adesso √® a Londra.</div>
      </div>

      <div class="q" data-type="text" data-answer="ever" data-points="1">
        <div class="qtitle">1.6 ____ si usa spesso nelle domande: ‚ÄúHai mai‚Ä¶?‚Äù</div>
        <input type="text" placeholder="ever / never ?" />
        <div class="feedback muted">Suggerimento: domanda con Present Perfect.</div>
      </div>

      <div class="q" data-type="text" data-answer="never" data-points="1">
        <div class="qtitle">1.7 ____ significa ‚Äúmai‚Äù in frasi affermative (senza not).</div>
        <input type="text" placeholder="ever / never ?" />
        <div class="feedback muted">Suggerimento: ‚ÄúI have ___ eaten sushi.‚Äù</div>
      </div>

      <div class="q" data-type="text" data-answer="life experience|experiences" data-points="1">
        <div class="qtitle">1.8 Present Perfect: per parlare di ______ (senza dire quando).</div>
        <input type="text" placeholder="Es: life experience" />
        <div class="feedback muted">Suggerimento: esperienze della vita.</div>
      </div>

      <!-- NEW: for/since + placement of ever/never -->
      <div class="q" data-type="text" data-answer="for + period|for + duration|for + a period of time|for + a time period" data-points="1">
        <div class="qtitle">1.9 ‚Äúfor‚Äù + ________ (durata): es. for two years</div>
        <input type="text" placeholder="Es: period / duration" />
        <div class="feedback muted">Suggerimento: for + periodo (durata).</div>
      </div>

      <div class="q" data-type="text" data-answer="since + starting point|since + a starting point|since + a point in time|since + a starting time" data-points="1">
        <div class="qtitle">1.10 ‚Äúsince‚Äù + ________ (inizio): es. since 2020</div>
        <input type="text" placeholder="Es: starting point / point in time" />
        <div class="feedback muted">Suggerimento: since + punto di inizio.</div>
      </div>

      <div class="q" data-type="mc" data-points="1" data-correct="between"
           data-explain="Ever/never di solito stanno tra have/has e il participio (V3).">
        <div class="qtitle">1.11 Dove metto ‚Äúnever‚Äù di solito?</div>
        <label><input type="radio" name="q1_11" value="before">Before have/has</label>
        <label><input type="radio" name="q1_11" value="between">Between have/has and V3</label>
        <label><input type="radio" name="q1_11" value="after">After V3</label>
      </div>

    </div>

    <div class="feedback warn">
      <b>Come autocontrollo:</b> dopo aver corretto, prova a dire a voce in 30 secondi la regola:
      ‚ÄúSimple Past ‚Üí tempo finito/preciso; Present Perfect ‚Üí esperienza/effetto sul presente/tempo non finito; been vs gone; ever vs never; for vs since‚Äù.
    </div>
  </section>

  <!-- CARD 2: Present Perfect vs Simple Past -->
  <section class="card" id="card-pp-vs-sp">
    <h2>2) Present Perfect o Simple Past? <span class="pill">10 punti</span></h2>
    <p class="hint">Scegli la forma corretta. Poi leggi la spiegazione se sbagli.</p>

    <div class="q" data-type="mc" data-points="1" data-correct="sp"
         data-explain="C‚Äô√® 'last year' ‚Üí tempo finito ‚Üí Simple Past.">
      <div class="qtitle">2.1 I ____ (visit) London last year.</div>
      <label><input type="radio" name="q2_1" value="pp">have visited</label>
      <label><input type="radio" name="q2_1" value="sp">visited</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="pp"
         data-explain="Non dici quando: esperienza di vita ‚Üí Present Perfect.">
      <div class="qtitle">2.2 I ____ (visit) London.</div>
      <label><input type="radio" name="q2_2" value="pp">have visited</label>
      <label><input type="radio" name="q2_2" value="sp">visited</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="pp"
         data-explain="'This week' (spesso tempo non finito) ‚Üí Present Perfect √® possibile/atteso.">
      <div class="qtitle">2.3 We ____ (watch) three films this week.</div>
      <label><input type="radio" name="q2_3" value="pp">have watched</label>
      <label><input type="radio" name="q2_3" value="sp">watched</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="sp"
         data-explain="'Yesterday' ‚Üí tempo finito ‚Üí Simple Past.">
      <div class="qtitle">2.4 She ____ (finish) her homework yesterday.</div>
      <label><input type="radio" name="q2_4" value="pp">has finished</label>
      <label><input type="radio" name="q2_4" value="sp">finished</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="pp"
         data-explain="Effetto sul presente: 'I have lost my keys' ‚Üí ora non le ho.">
      <div class="qtitle">2.5 I ____ (lose) my keys! I can‚Äôt open the door.</div>
      <label><input type="radio" name="q2_5" value="pp">have lost</label>
      <label><input type="radio" name="q2_5" value="sp">lost</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="sp"
         data-explain="'Two hours ago' ‚Üí tempo finito ‚Üí Simple Past.">
      <div class="qtitle">2.6 They ____ (arrive) two hours ago.</div>
      <label><input type="radio" name="q2_6" value="pp">have arrived</label>
      <label><input type="radio" name="q2_6" value="sp">arrived</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="pp"
         data-explain="'For' + durata (e situazione che continua) ‚Üí Present Perfect.">
      <div class="qtitle">2.7 I ____ (live) here for three years.</div>
      <label><input type="radio" name="q2_7" value="pp">have lived</label>
      <label><input type="radio" name="q2_7" value="sp">lived</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="sp"
         data-explain="'In 2020' √® un momento preciso ‚Üí Simple Past.">
      <div class="qtitle">2.8 We ____ (move) to Rome in 2020.</div>
      <label><input type="radio" name="q2_8" value="pp">have moved</label>
      <label><input type="radio" name="q2_8" value="sp">moved</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="pp"
         data-explain="Domanda su esperienza: ever + Present Perfect.">
      <div class="qtitle">2.9 ____ you ever ____ (eat) sushi?</div>
      <label><input type="radio" name="q2_9" value="pp">Have ‚Ä¶ eaten</label>
      <label><input type="radio" name="q2_9" value="sp">Did ‚Ä¶ eat</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="sp"
         data-explain="'Last night' ‚Üí tempo finito ‚Üí Simple Past.">
      <div class="qtitle">2.10 I ____ (feel) nervous before the match last night.</div>
      <label><input type="radio" name="q2_10" value="pp">have felt</label>
      <label><input type="radio" name="q2_10" value="sp">felt</label>
    </div>

  </section>

  <!-- CARD 3: Have been / Have gone -->
  <section class="card" id="card-been-gone">
    <h2>3) Have been / Have gone <span class="pill">6 punti</span></h2>
    <p class="hint">Scegli: <b>been</b> (= andato e tornato) / <b>gone</b> (= andato ed √® ancora l√¨).</p>

    <div class="q" data-type="mc" data-points="1" data-correct="been"
         data-explain="√à tornato a casa ‚Üí 'have been'.">
      <div class="qtitle">3.1 Marco is back home. He has ____ to Milan.</div>
      <label><input type="radio" name="q3_1" value="been">been</label>
      <label><input type="radio" name="q3_1" value="gone">gone</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="gone"
         data-explain="Non √® qui: √® ancora l√† ‚Üí 'have gone'.">
      <div class="qtitle">3.2 Anna isn‚Äôt here. She has ____ to the supermarket.</div>
      <label><input type="radio" name="q3_2" value="been">been</label>
      <label><input type="radio" name="q3_2" value="gone">gone</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="been"
         data-explain="Esperienza di vita ‚Üí spesso 'have been to'.">
      <div class="qtitle">3.3 I have ____ to London. It was amazing!</div>
      <label><input type="radio" name="q3_3" value="been">been</label>
      <label><input type="radio" name="q3_3" value="gone">gone</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="gone"
         data-explain="√à partito e adesso √® l√¨ ‚Üí 'has gone to'.">
      <div class="qtitle">3.4 My dad has ____ to work. He‚Äôll be back later.</div>
      <label><input type="radio" name="q3_4" value="been">been</label>
      <label><input type="radio" name="q3_4" value="gone">gone</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="been"
         data-explain="Tornati da scuola ‚Üí 'have been'.">
      <div class="qtitle">3.5 We have ____ at school all day. Now we‚Äôre tired.</div>
      <label><input type="radio" name="q3_5" value="been">been</label>
      <label><input type="radio" name="q3_5" value="gone">gone</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="gone"
         data-explain="Se non √® qui, probabilmente √® ancora fuori ‚Üí 'has gone'.">
      <div class="qtitle">3.6 Where‚Äôs Luca? He has ____ to the gym.</div>
      <label><input type="radio" name="q3_6" value="been">been</label>
      <label><input type="radio" name="q3_6" value="gone">gone</label>
    </div>
  </section>

  <!-- CARD 4: Ever / Never -->
  <section class="card" id="card-ever-never">
    <h2>4) Ever / Never <span class="pill">6 punti</span></h2>
    <p class="hint">Completa con <b>ever</b> o <b>never</b>. Attento: <b>never</b> non vuole ‚Äúnot‚Äù.</p>

    <div class="q" data-type="fill" data-points="1" data-answer="ever"
         data-explain="Domanda: 'ever' = mai (in vita tua)?">
      <div class="qtitle">4.1 Have you ____ ridden a horse?</div>
      <input type="text" placeholder="ever / never" />
    </div>

    <div class="q" data-type="fill" data-points="1" data-answer="never"
         data-explain="Frase affermativa negativa: 'never' = mai.">
      <div class="qtitle">4.2 I have ____ seen snow.</div>
      <input type="text" placeholder="ever / never" />
    </div>

    <div class="q" data-type="fill" data-points="1" data-answer="ever"
         data-explain="Domanda: 'Have you ever...?'">
      <div class="qtitle">4.3 Has she ____ met a famous person?</div>
      <input type="text" placeholder="ever / never" />
    </div>

    <div class="q" data-type="fill" data-points="1" data-answer="never"
         data-explain="Mai = 'never' (senza not).">
      <div class="qtitle">4.4 We have ____ been to the USA.</div>
      <input type="text" placeholder="ever / never" />
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="good"
         data-explain="Non si dice 'haven‚Äôt never'.">
      <div class="qtitle">4.5 Quale frase √® corretta?</div>
      <label><input type="radio" name="q4_5" value="bad">I haven‚Äôt never eaten sushi.</label>
      <label><input type="radio" name="q4_5" value="good">I have never eaten sushi.</label>
    </div>

    <div class="q" data-type="mc" data-points="1" data-correct="good"
         data-explain="Ever di solito nelle domande; never nelle affermazioni.">
      <div class="qtitle">4.6 Quale domanda √® corretta?</div>
      <label><input type="radio" name="q4_6" value="good">Have you ever tried skateboarding?</label>
      <label><input type="radio" name="q4_6" value="bad">Did you ever tried skateboarding?</label>
    </div>
  </section>

  <!-- CARD 5: Emotions / unforgettable experiences -->
  <section class="card" id="card-emotions">
    <h2>5) Esperienze ed emozioni <span class="pill">8 punti</span></h2>
    <p class="hint">
      Scegli la frase pi√π adatta e completa. Qui devi collegare: esperienza (spesso Present Perfect) e momento preciso (Simple Past).
    </p>

    <div class="q" data-type="mc" data-points="2" data-correct="A"
         data-explain="A: esperienza senza quando ‚Üí Present Perfect. B: 'yesterday' ‚Üí Simple Past.">
      <div class="qtitle">5.1 Quale coppia √® corretta?</div>
      <label><input type="radio" name="q5_1" value="A">A) I have been to Paris. / B) I went there yesterday.</label>
      <label><input type="radio" name="q5_1" value="B">A) I went to Paris. / B) I have been there yesterday.</label>
    </div>

    <div class="q" data-type="mc" data-points="2" data-correct="B"
         data-explain="B: emozione in un momento preciso (before the test yesterday) ‚Üí Simple Past.">
      <div class="qtitle">5.2 Scegli la frase pi√π corretta:</div>
      <label><input type="radio" name="q5_2" value="A">I have been nervous before the test yesterday.</label>
      <label><input type="radio" name="q5_2" value="B">I was nervous before the test yesterday.</label>
    </div>

    <div class="q" data-type="mc" data-points="2" data-correct="A"
         data-explain="A: risultato/effetto sul presente ‚Üí Present Perfect ('now I can‚Äôt').">
      <div class="qtitle">5.3 Scegli la frase pi√π corretta:</div>
      <label><input type="radio" name="q5_3" value="A">I have broken my phone. Now I can‚Äôt call you.</label>
      <label><input type="radio" name="q5_3" value="B">I broke my phone. Now I can‚Äôt call you.</label>
    </div>

    <div class="q" data-type="mc" data-points="2" data-correct="B"
         data-explain="B: 'in 2021' ‚Üí tempo finito ‚Üí Simple Past.">
      <div class="qtitle">5.4 Scegli la frase pi√π corretta:</div>
      <label><input type="radio" name="q5_4" value="A">I have met my best friend in 2021.</label>
      <label><input type="radio" name="q5_4" value="B">I met my best friend in 2021.</label>
    </div>

    <div class="feedback warn">
      <b>Trucco memoria:</b> se vedi ‚Äúyesterday/last/in 2020/ago‚Äù ‚Üí <b>Simple Past</b>.
      Se non vedi ‚Äúquando‚Äù ‚Üí spesso <b>Present Perfect</b>.
    </div>
  </section>

  <!-- SOLUTIONS -->
  <section class="card" id="solutions">
    <h2>Soluzioni (visibili) <span class="pill">Reference</span></h2>
    <p class="hint">Non leggerle subito üòÑ Prima prova, poi correggi.</p>

    <details open>
      <summary>Mostra/Nascondi soluzioni</summary>
      <div class="sol" id="solText">
1) Ripasso lampo
1.1 have/has + past participle
1.2 definite time / finished time / when / specific time
1.3 not finished (unfinished time)
1.4 been
1.5 gone
1.6 ever
1.7 never
1.8 life experience
1.9 for + period (duration)
1.10 since + starting point
1.11 Between have/has and V3

2) Present Perfect vs Simple Past
2.1 visited (SP)
2.2 have visited (PP)
2.3 have watched (PP)
2.4 finished (SP)
2.5 have lost (PP)
2.6 arrived (SP)
2.7 have lived (PP)
2.8 moved (SP)
2.9 Have ‚Ä¶ eaten (PP)
2.10 felt (SP)

3) Have been / have gone
3.1 been
3.2 gone
3.3 been
3.4 gone
3.5 been
3.6 gone

4) Ever / Never
4.1 ever
4.2 never
4.3 ever
4.4 never
4.5 I have never eaten sushi.
4.6 Have you ever tried...?

5) Emozioni
5.1 A
5.2 B
5.3 A
5.4 B
      </div>
    </details>
  </section>

</main>

<script>
  // Helpers
  function norm(s){
    return (s || "")
      .toString()
      .trim()
      .toLowerCase()
      .replace(/\s+/g, " ");
  }

  const allQuestions = Array.from(document.querySelectorAll(".q"));
  const scoreEl = document.getElementById("score");
  const totalEl = document.getElementById("total");
  const triesEl = document.getElementById("tries");
  const checkAllBtn = document.getElementById("checkAllBtn");
  const resetBtn = document.getElementById("resetBtn");

  // total points
  const totalPoints = allQuestions.reduce((acc, q) => acc + Number(q.dataset.points || 0), 0);
  totalEl.textContent = totalPoints;

  let tries = 0;

  function setFeedback(q, kind, html){
    // ensure we have a feedback box
    let fb = q.querySelector(".feedback.dynamic");
    if(!fb){
      fb = document.createElement("div");
      fb.className = "feedback dynamic";
      q.appendChild(fb);
    }
    fb.classList.remove("ok","bad","warn");
    fb.classList.add(kind);
    fb.innerHTML = html;
  }

  function clearDynamicFeedback(){
    document.querySelectorAll(".feedback.dynamic").forEach(el => el.remove());
  }

  function checkQuestion(q){
    const type = q.dataset.type;
    const points = Number(q.dataset.points || 0);

    if(type === "mc"){
      const radios = Array.from(q.querySelectorAll('input[type="radio"]'));
      const picked = radios.find(r => r.checked)?.value;
      const correct = q.dataset.correct;

      if(!picked){
        setFeedback(q, "warn", "‚è≥ Scegli una risposta.");
        return { earned: 0, max: points, answered: false };
      }
      const ok = picked === correct;
      const explain = q.dataset.explain ? `<div class="small muted">Perch√©: ${q.dataset.explain}</div>` : "";
      setFeedback(q, ok ? "ok" : "bad",
        (ok ? "‚úÖ Giusto!" : `‚ùå Sbagliato. Risposta corretta: <b>${correct}</b>.`) + explain
      );
      return { earned: ok ? points : 0, max: points, answered: true };
    }

    if(type === "fill" || type === "text"){
      const input = q.querySelector('input[type="text"]');
      const value = norm(input?.value);

      if(!value){
        setFeedback(q, "warn", "‚è≥ Scrivi una risposta.");
        return { earned: 0, max: points, answered: false };
      }

      // UPDATED: allow alternatives with "|" (OR) for text answers
      const ansRaw = (q.dataset.answer || "");
      const ans = norm(ansRaw);

      let ok = false;

      if(type === "fill"){
        ok = value === ans;
      } else {
        const alternatives = ansRaw.split("|").map(a => norm(a)).filter(Boolean);

        if(alternatives.length > 1){
          ok = alternatives.some(a => a && value.includes(a));
        } else {
          // Default behavior: require all keywords from answer to appear somewhere in input
          const needed = ans.split(" + ").join(" ").split(" ").filter(Boolean);
          ok = needed.every(k => value.includes(k));
        }
      }

      const explain = q.dataset.explain ? `<div class="small muted">Perch√©: ${q.dataset.explain}</div>` : "";
      setFeedback(q, ok ? "ok" : "bad",
        (ok ? "‚úÖ Giusto!" : `‚ùå Sbagliato. Risposta corretta: <b>${q.dataset.answer}</b>.`) + explain
      );
      return { earned: ok ? points : 0, max: points, answered: true };
    }

    return { earned: 0, max: points, answered: false };
  }

  function checkAll(){
    tries += 1;
    triesEl.textContent = tries;
    clearDynamicFeedback();

    let earned = 0;
    let answeredCount = 0;

    for(const q of allQuestions){
      const res = checkQuestion(q);
      earned += res.earned;
      if(res.answered) answeredCount += 1;
    }

    scoreEl.textContent = earned;

    const pct = Math.round((earned / totalPoints) * 100);
    const msg =
      pct === 100 ? "Perfetto üíØ" :
      pct >= 80 ? "Ottimo! Ancora 1 giro veloce e sei a posto." :
      pct >= 60 ? "Buono. Rivedi gli errori e riprova." :
      "Serve un altro giro: leggi le spiegazioni e ripeti le regole a voce.";

    let summary = document.getElementById("summaryBox");
    if(!summary){
      summary = document.createElement("div");
      summary.id = "summaryBox";
      summary.className = "feedback " + (pct>=80 ? "ok" : pct>=60 ? "warn" : "bad");
      summary.style.marginTop = "12px";
      document.querySelector(".title").appendChild(summary);
    }
    summary.className = "feedback " + (pct>=80 ? "ok" : pct>=60 ? "warn" : "bad");
    summary.innerHTML = `<b>Risultato:</b> ${earned}/${totalPoints} (${pct}%). ${msg}<div class="small muted">Domande risposte: ${answeredCount}/${allQuestions.length}</div>`;
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function resetAll(){
    tries = 0;
    triesEl.textContent = tries;
    scoreEl.textContent = "0";
    clearDynamicFeedback();

    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.querySelectorAll('input[type="text"]').forEach(t => t.value = "");

    const summary = document.getElementById("summaryBox");
    if(summary) summary.remove();

    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  checkAllBtn.addEventListener("click", checkAll);
  resetBtn.addEventListener("click", resetAll);
</script>
</body>
</html>
