<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Unit 3 â€“ Present Perfect (Ripasso + Quiz immediato)</title>
  <style>
    :root{
      --bg:#0b1020;
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.65);
      --line:rgba(255,255,255,0.14);
      --shadow:0 10px 30px rgba(0,0,0,0.35);
      --radius:18px;
      --ok:rgba(0,255,170,0.85);
      --bad:rgba(255,90,90,0.9);
      --warn:rgba(255,210,80,0.9);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(80,120,255,0.20), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(0,255,170,0.14), transparent 55%),
        radial-gradient(900px 700px at 40% 90%, rgba(255,90,90,0.12), transparent 55%),
        var(--bg);
      min-height:100vh; padding:22px;
    }
    header{
      max-width:980px; margin:0 auto 18px auto;
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    .title{
      flex:1 1 560px;
      background:linear-gradient(135deg, rgba(255,255,255,0.14), rgba(255,255,255,0.06));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:16px 18px;
      box-shadow:var(--shadow);
    }
    h1{ margin:0 0 8px 0; font-size:20px; letter-spacing:.2px; }
    .subtitle{ color:var(--muted); font-size:13.5px; line-height:1.35; }
    .panel{
      flex:0 1 360px; min-width:280px;
      background:linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px 16px;
      box-shadow:var(--shadow);
    }
    .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .pill{
      font-family:var(--mono); font-size:12px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.06);
    }
    .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,0.12);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
      transition:.15s transform, .15s background;
      user-select:none;
    }
    .btn:hover{ background:rgba(255,255,255,0.18); transform:translateY(-1px); }
    .btn:active{ transform:translateY(0); }
    main{ max-width:980px; margin:0 auto; display:flex; flex-direction:column; gap:14px; }

    .card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
      box-shadow:var(--shadow);
      padding:16px 18px;
    }
    .card h2{
      margin:0 0 10px 0; font-size:16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .hint{ color:var(--muted); font-size:13px; line-height:1.45; margin:0 0 10px 0; }

    /* Slides */
    .slides{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width:760px){ .slides{ grid-template-columns:1fr; } }
    .slide{
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(255,255,255,0.05);
      padding:14px 14px;
    }
    .slide .stitle{ font-weight:850; margin:0 0 6px 0; }
    .slide ul{ margin:8px 0 0 18px; padding:0; color:rgba(255,255,255,0.88); }
    .slide li{ margin:6px 0; }
    .mono{ font-family:var(--mono); font-size:12.5px; color:rgba(255,255,255,0.86); }

    /* Questions */
    .q{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 12px;
      background:rgba(255,255,255,0.05);
      margin:10px 0;
    }
    .qtitle{ font-weight:800; margin-bottom:8px; }
    .prompt{
      font-family:var(--mono);
      font-size:12.5px;
      color:rgba(255,255,255,0.9);
      background:rgba(0,0,0,0.16);
      border:1px solid var(--line);
      padding:10px 10px;
      border-radius:12px;
      margin:8px 0 10px 0;
      white-space:pre-wrap;
    }
    label{ display:block; margin:7px 0; cursor:pointer; }
    input[type="radio"]{ transform:translateY(1px); margin-right:8px; }

    .feedback{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.04);
      font-size:13.5px; line-height:1.35;
    }
    .ok{ border-color:rgba(0,255,170,0.35); background:rgba(0,255,170,0.10); }
    .bad{ border-color:rgba(255,90,90,0.35); background:rgba(255,90,90,0.10); }
    .warn{ border-color:rgba(255,210,80,0.35); background:rgba(255,210,80,0.10); }
    .small{ font-size:12.5px; color:var(--muted); }

    details{
      margin-top:8px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(255,255,255,0.04);
    }
    summary{ cursor:pointer; font-weight:850; }

    .recapList{
      margin: 0;
      padding: 0;
      list-style: none;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .recapItem{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background:rgba(255,255,255,0.04);
    }
    .recapItem b{ font-family:var(--mono); }
  </style>
</head>
<body>

<header>
  <div class="title">
    <h1>Unit 3 â€“ Present Perfect | Ripasso + Quiz con risultato immediato</h1>
    <div class="subtitle">
      âœ… Appena scegli una risposta, ricevi subito: <b>giusto/sbagliato + spiegazione</b>.
      <br>In basso trovi anche un <b>recap degli errori</b> per ripassare velocemente.
    </div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="pill">Punteggio: <span id="score">0</span>/<span id="total">0</span></div>
      <div class="pill">Risposte: <span id="answered">0</span>/<span id="qcount">0</span></div>
    </div>
    <div style="height:10px"></div>
    <div class="row">
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn" id="checkAllBtn">Ricalcola</button>
    </div>
    <div style="height:10px"></div>
    <div class="hint" style="margin:0">
      <span class="mono">Tip:</span> dopo ogni errore, ripeti la regola a voce alta (10 secondi).
    </div>
  </div>
</header>

<main>

  <!-- RIPASSO SLIDE -->
  <section class="card" id="card-slides">
    <h2>Ripasso generale (come slide da leggere) <span class="pill">2 minuti</span></h2>
    <p class="hint">Leggi a voce alta. Poi prova a ripetere a memoria: â€œPP vs SP, for/since, been/gone, ever/neverâ€.</p>

    <div class="slides">
      <div class="slide">
        <div class="stitle">Slide 1 â€” Forma del Present Perfect</div>
        <div class="mono">S + have/has + V3 â€¢ havenâ€™t/hasnâ€™t + V3 â€¢ Have/Has + S + V3?</div>
        <ul>
          <li>He <b>has finished</b> his homework.</li>
          <li><b>Have</b> you <b>ever been</b> to London?</li>
        </ul>
      </div>

      <div class="slide">
        <div class="stitle">Slide 2 â€” Present Perfect: quando si usa</div>
        <ul>
          <li><b>Esperienze</b> (non dici quando): â€œI have tried sushi.â€</li>
          <li><b>Effetto nel presente</b>: â€œI have lost my keys.â€</li>
          <li><b>Tempo non finito</b>: â€œthis week / todayâ€ (se non Ã¨ finito)</li>
        </ul>
      </div>

      <div class="slide">
        <div class="stitle">Slide 3 â€” Simple Past: quando si usa</div>
        <ul>
          <li><b>Tempo finito/preciso</b>: yesterday, last year, in 2020, agoâ€¦</li>
          <li>Fatto â€œchiusoâ€ nel passato: â€œI visited London last year.â€</li>
        </ul>
      </div>

      <div class="slide">
        <div class="stitle">Slide 4 â€” Trucco velocissimo</div>
        <ul>
          <li>Se vedi <b>yesterday/last/in 2020/ago</b> â†’ <b>Simple Past</b>.</li>
          <li>Se non vedi â€œquandoâ€ â†’ spesso <b>Present Perfect</b>.</li>
          <li>Se â€œconta adessoâ€ (risultato) â†’ <b>Present Perfect</b>.</li>
        </ul>
      </div>

      <div class="slide">
        <div class="stitle">Slide 5 â€” For / Since</div>
        <ul>
          <li><b>for</b> + durata: for two hours / for three years</li>
          <li><b>since</b> + inizio: since 2020 / since Monday</li>
        </ul>
      </div>

      <div class="slide">
        <div class="stitle">Slide 6 â€” Have been / Have gone</div>
        <ul>
          <li><b>have been</b> = andato e tornato</li>
          <li><b>have gone</b> = andato ed Ã¨ ancora lÃ¬</li>
        </ul>
      </div>

      <div class="slide">
        <div class="stitle">Slide 7 â€” Ever / Never</div>
        <ul>
          <li><b>ever</b> nelle domande: â€œHave you everâ€¦?â€</li>
          <li><b>never</b> = mai (senza â€œnotâ€): â€œI have neverâ€¦â€</li>
          <li>Posizione tipica: have/has + <b>ever/never</b> + V3</li>
        </ul>
      </div>

      <div class="slide">
        <div class="stitle">Slide 8 â€” Esperienze ed emozioni</div>
        <ul>
          <li>Generale: â€œI have been happy.â€ (non dici quando)</li>
          <li>Preciso: â€œI was nervous yesterday.â€</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- QUIZ TEMPO -->
  <section class="card" id="card-tense">
    <h2>Quiz A â€” Scegli il tempo giusto <span class="pill">12 punti</span></h2>
    <p class="hint">Scegli una risposta: il risultato appare subito sotto con la spiegazione.</p>

    <div class="q" data-id="A1" data-type="mc" data-points="1" data-correct="SP"
         data-explain="Câ€™Ã¨ un tempo finito: â€œlast yearâ€ â†’ Simple Past.">
      <div class="qtitle">A1) Tempo corretto</div>
      <div class="prompt">I ____ (visit) London last year.</div>
      <label><input type="radio" name="A1" value="PP">Present Perfect: have visited</label>
      <label><input type="radio" name="A1" value="SP">Simple Past: visited</label>
    </div>

    <div class="q" data-id="A2" data-type="mc" data-points="1" data-correct="PP"
         data-explain="Non dici quando: esperienza di vita â†’ Present Perfect.">
      <div class="qtitle">A2) Tempo corretto</div>
      <div class="prompt">I ____ (visit) London.</div>
      <label><input type="radio" name="A2" value="PP">Present Perfect: have visited</label>
      <label><input type="radio" name="A2" value="SP">Simple Past: visited</label>
    </div>

    <div class="q" data-id="A3" data-type="mc" data-points="1" data-correct="PP"
         data-explain="Effetto nel presente: ora non puÃ² aprire â†’ Present Perfect.">
      <div class="qtitle">A3) Tempo corretto</div>
      <div class="prompt">I ____ (lose) my keys. I canâ€™t open the door.</div>
      <label><input type="radio" name="A3" value="PP">Present Perfect: have lost</label>
      <label><input type="radio" name="A3" value="SP">Simple Past: lost</label>
    </div>

    <div class="q" data-id="A4" data-type="mc" data-points="1" data-correct="SP"
         data-explain="Tempo finito: â€œagoâ€ â†’ Simple Past.">
      <div class="qtitle">A4) Tempo corretto</div>
      <div class="prompt">They ____ (arrive) two hours ago.</div>
      <label><input type="radio" name="A4" value="PP">Present Perfect: have arrived</label>
      <label><input type="radio" name="A4" value="SP">Simple Past: arrived</label>
    </div>

    <div class="q" data-id="A5" data-type="mc" data-points="1" data-correct="PP"
         data-explain="â€œThis weekâ€ puÃ² essere un tempo non finito â†’ spesso Present Perfect.">
      <div class="qtitle">A5) Tempo corretto</div>
      <div class="prompt">We ____ (watch) three films this week.</div>
      <label><input type="radio" name="A5" value="PP">Present Perfect: have watched</label>
      <label><input type="radio" name="A5" value="SP">Simple Past: watched</label>
    </div>

    <div class="q" data-id="A6" data-type="mc" data-points="1" data-correct="PP"
         data-explain="â€œforâ€ + durata (spesso continua fino ad ora) â†’ Present Perfect.">
      <div class="qtitle">A6) Tempo corretto</div>
      <div class="prompt">I ____ (live) here for three years.</div>
      <label><input type="radio" name="A6" value="PP">Present Perfect: have lived</label>
      <label><input type="radio" name="A6" value="SP">Simple Past: lived</label>
    </div>

    <div class="q" data-id="A7" data-type="mc" data-points="1" data-correct="GONE"
         data-explain="Non Ã¨ qui: Ã¨ andata ed Ã¨ ancora lÃ¬ â†’ have gone.">
      <div class="qtitle">A7) Been o gone?</div>
      <div class="prompt">Anna isnâ€™t here. She has ____ to the supermarket.</div>
      <label><input type="radio" name="A7" value="BEEN">been</label>
      <label><input type="radio" name="A7" value="GONE">gone</label>
    </div>

    <div class="q" data-id="A8" data-type="mc" data-points="1" data-correct="BEEN"
         data-explain="Ãˆ tornato: been = andato e tornato.">
      <div class="qtitle">A8) Been o gone?</div>
      <div class="prompt">Marco is back home. He has ____ to Milan.</div>
      <label><input type="radio" name="A8" value="BEEN">been</label>
      <label><input type="radio" name="A8" value="GONE">gone</label>
    </div>

    <div class="q" data-id="A9" data-type="mc" data-points="1" data-correct="EVER"
         data-explain="Domanda su esperienza: â€œHave you everâ€¦?â€">
      <div class="qtitle">A9) Ever o never?</div>
      <div class="prompt">Have you ____ eaten sushi?</div>
      <label><input type="radio" name="A9" value="EVER">ever</label>
      <label><input type="radio" name="A9" value="NEVER">never</label>
    </div>

    <div class="q" data-id="A10" data-type="mc" data-points="1" data-correct="NEVER"
         data-explain="â€œneverâ€ = mai (frase negativa senza â€œnotâ€).">
      <div class="qtitle">A10) Ever o never?</div>
      <div class="prompt">I have ____ seen snow.</div>
      <label><input type="radio" name="A10" value="EVER">ever</label>
      <label><input type="radio" name="A10" value="NEVER">never</label>
    </div>

    <div class="q" data-id="A11" data-type="mc" data-points="1" data-correct="SP"
         data-explain="Tempo finito: â€œyesterdayâ€ â†’ Simple Past.">
      <div class="qtitle">A11) Tempo corretto</div>
      <div class="prompt">She ____ (finish) her homework yesterday.</div>
      <label><input type="radio" name="A11" value="PP">Present Perfect: has finished</label>
      <label><input type="radio" name="A11" value="SP">Simple Past: finished</label>
    </div>

    <div class="q" data-id="A12" data-type="mc" data-points="1" data-correct="SP"
         data-explain="Momento preciso: â€œin 2021â€ â†’ Simple Past.">
      <div class="qtitle">A12) Tempo corretto</div>
      <div class="prompt">I ____ (meet) my best friend in 2021.</div>
      <label><input type="radio" name="A12" value="PP">Present Perfect: have met</label>
      <label><input type="radio" name="A12" value="SP">Simple Past: met</label>
    </div>
  </section>

  <!-- QUIZ PERCHE' -->
  <section class="card" id="card-why">
    <h2>Quiz B â€” Scegli il â€œperchÃ©â€ (motivazione) <span class="pill">12 punti</span></h2>
    <p class="hint">Stesse situazioni: scegli il motivo (cosÃ¬ memorizzi la regola).</p>

    <div class="q" data-id="B1" data-type="mc" data-points="1" data-correct="DEF_TIME"
         data-explain="Past Simple con tempo finito/preciso: yesterday/last/in 2020/ago.">
      <div class="qtitle">B1) PerchÃ© in A1 si usa Simple Past?</div>
      <div class="prompt">I visited London last year.</div>
      <label><input type="radio" name="B1" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito/preciso (â€œlast yearâ€).</label>
      <label><input type="radio" name="B1" value="LIFE_EXP">PerchÃ© Ã¨ unâ€™esperienza di vita senza â€œquandoâ€.</label>
      <label><input type="radio" name="B1" value="RESULT_NOW">PerchÃ© conta il risultato nel presente.</label>
    </div>

    <div class="q" data-id="B2" data-type="mc" data-points="1" data-correct="LIFE_EXP"
         data-explain="Present Perfect spesso per esperienze (senza dire quando).">
      <div class="qtitle">B2) PerchÃ© in A2 si usa Present Perfect?</div>
      <div class="prompt">I have visited London.</div>
      <label><input type="radio" name="B2" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito/preciso.</label>
      <label><input type="radio" name="B2" value="LIFE_EXP">PerchÃ© non dico quando: esperienza di vita.</label>
      <label><input type="radio" name="B2" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
    </div>

    <div class="q" data-id="B3" data-type="mc" data-points="1" data-correct="RESULT_NOW"
         data-explain="Present Perfect per risultato/effetto nel presente.">
      <div class="qtitle">B3) PerchÃ© in A3 si usa Present Perfect?</div>
      <div class="prompt">I have lost my keys. I canâ€™t open the door.</div>
      <label><input type="radio" name="B3" value="RESULT_NOW">PerchÃ© lâ€™effetto Ã¨ nel presente.</label>
      <label><input type="radio" name="B3" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito/preciso.</label>
      <label><input type="radio" name="B3" value="SINCE">PerchÃ© câ€™Ã¨ â€œsinceâ€.</label>
    </div>

    <div class="q" data-id="B4" data-type="mc" data-points="1" data-correct="AGO"
         data-explain="â€œagoâ€ indica un tempo finito nel passato â†’ Simple Past.">
      <div class="qtitle">B4) PerchÃ© in A4 si usa Simple Past?</div>
      <div class="prompt">They arrived two hours ago.</div>
      <label><input type="radio" name="B4" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
      <label><input type="radio" name="B4" value="LIFE_EXP">PerchÃ© Ã¨ unâ€™esperienza di vita.</label>
      <label><input type="radio" name="B4" value="UNFINISHED">PerchÃ© il tempo non Ã¨ finito.</label>
    </div>

    <div class="q" data-id="B5" data-type="mc" data-points="1" data-correct="UNFINISHED"
         data-explain="This week/today puÃ² essere un periodo non finito â†’ spesso Present Perfect.">
      <div class="qtitle">B5) PerchÃ© in A5 si usa Present Perfect?</div>
      <div class="prompt">We have watched three films this week.</div>
      <label><input type="radio" name="B5" value="UNFINISHED">PerchÃ© â€œthis weekâ€ puÃ² essere un tempo non finito.</label>
      <label><input type="radio" name="B5" value="DEF_TIME">PerchÃ© â€œthis weekâ€ Ã¨ un tempo finito.</label>
      <label><input type="radio" name="B5" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
    </div>

    <div class="q" data-id="B6" data-type="mc" data-points="1" data-correct="DURATION"
         data-explain="For + durata (spesso continua fino ad ora) â†’ Present Perfect.">
      <div class="qtitle">B6) PerchÃ© in A6 si usa Present Perfect?</div>
      <div class="prompt">I have lived here for three years.</div>
      <label><input type="radio" name="B6" value="DURATION">PerchÃ© â€œforâ€ indica durata.</label>
      <label><input type="radio" name="B6" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito/preciso.</label>
      <label><input type="radio" name="B6" value="EVER">PerchÃ© câ€™Ã¨ â€œeverâ€.</label>
    </div>

    <div class="q" data-id="B7" data-type="mc" data-points="1" data-correct="GONE_NOT_HERE"
         data-explain="Have gone = Ã¨ andato ed Ã¨ ancora lÃ¬ (non Ã¨ qui).">
      <div class="qtitle">B7) PerchÃ© in A7 la risposta Ã¨ â€œgoneâ€?</div>
      <div class="prompt">Anna isnâ€™t here. She has gone to the supermarket.</div>
      <label><input type="radio" name="B7" value="GONE_NOT_HERE">PerchÃ© non Ã¨ qui: Ã¨ ancora lÃ¬.</label>
      <label><input type="radio" name="B7" value="BEEN_BACK">PerchÃ© Ã¨ tornata.</label>
      <label><input type="radio" name="B7" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito.</label>
    </div>

    <div class="q" data-id="B8" data-type="mc" data-points="1" data-correct="BEEN_BACK"
         data-explain="Have been = andato e tornato (Ã¨ back home).">
      <div class="qtitle">B8) PerchÃ© in A8 la risposta Ã¨ â€œbeenâ€?</div>
      <div class="prompt">Marco is back home. He has been to Milan.</div>
      <label><input type="radio" name="B8" value="BEEN_BACK">PerchÃ© Ã¨ tornato: been = andato e tornato.</label>
      <label><input type="radio" name="B8" value="GONE_NOT_HERE">PerchÃ© non Ã¨ qui.</label>
      <label><input type="radio" name="B8" value="EVER">PerchÃ© Ã¨ una domanda con ever.</label>
    </div>

    <div class="q" data-id="B9" data-type="mc" data-points="1" data-correct="EVER_Q"
         data-explain="Ever si usa spesso nelle domande su esperienze.">
      <div class="qtitle">B9) PerchÃ© in A9 si usa â€œeverâ€?</div>
      <div class="prompt">Have you ever eaten sushi?</div>
      <label><input type="radio" name="B9" value="EVER_Q">PerchÃ© Ã¨ una domanda â€œHai maiâ€¦?â€.</label>
      <label><input type="radio" name="B9" value="NEVER_NEG">PerchÃ© Ã¨ una frase negativa.</label>
      <label><input type="radio" name="B9" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito.</label>
    </div>

    <div class="q" data-id="B10" data-type="mc" data-points="1" data-correct="NEVER_NEG"
         data-explain="Never = mai, in frase affermativa (senza not).">
      <div class="qtitle">B10) PerchÃ© in A10 si usa â€œneverâ€?</div>
      <div class="prompt">I have never seen snow.</div>
      <label><input type="radio" name="B10" value="NEVER_NEG">PerchÃ© â€œneverâ€ = mai (senza â€œnotâ€).</label>
      <label><input type="radio" name="B10" value="EVER_Q">PerchÃ© Ã¨ una domanda.</label>
      <label><input type="radio" name="B10" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
    </div>

    <div class="q" data-id="B11" data-type="mc" data-points="1" data-correct="DEF_TIME"
         data-explain="Yesterday Ã¨ tempo finito â†’ Simple Past.">
      <div class="qtitle">B11) PerchÃ© in A11 si usa Simple Past?</div>
      <div class="prompt">She finished her homework yesterday.</div>
      <label><input type="radio" name="B11" value="DEF_TIME">PerchÃ© â€œyesterdayâ€ Ã¨ tempo finito/preciso.</label>
      <label><input type="radio" name="B11" value="RESULT_NOW">PerchÃ© conta il risultato nel presente.</label>
      <label><input type="radio" name="B11" value="UNFINISHED">PerchÃ© il tempo non Ã¨ finito.</label>
    </div>

    <div class="q" data-id="B12" data-type="mc" data-points="1" data-correct="DEF_TIME"
         data-explain="In 2021 Ã¨ un momento preciso â†’ Simple Past.">
      <div class="qtitle">B12) PerchÃ© in A12 si usa Simple Past?</div>
      <div class="prompt">I met my best friend in 2021.</div>
      <label><input type="radio" name="B12" value="DEF_TIME">PerchÃ© â€œin 2021â€ Ã¨ un momento preciso.</label>
      <label><input type="radio" name="B12" value="LIFE_EXP">PerchÃ© non dico quando.</label>
      <label><input type="radio" name="B12" value="DURATION">PerchÃ© câ€™Ã¨ â€œforâ€.</label>
    </div>
  </section>

  <!-- ========== EXTRA DOMANDE (Unit 3) ========== -->

<!-- QUIZ A EXTRA â€” Tempo -->
<section class="card" id="card-tense-extra">
  <h2>Quiz A Extra â€” Tempo (ripasso completo) <span class="pill">10 punti</span></h2>
  <p class="hint">Domande extra su: since/for, today (finito o no), already/just/yet, never + not, been to vs been in.</p>

  <!-- A13: since -->
  <div class="q" data-id="A13" data-type="mc" data-points="1" data-correct="PP"
       data-explain="â€œsinceâ€ indica un punto di inizio: spesso Present Perfect.">
    <div class="qtitle">A13) Tempo corretto</div>
    <div class="prompt">I ____ (know) him since 2020.</div>
    <label><input type="radio" name="A13" value="PP">Present Perfect: have known</label>
    <label><input type="radio" name="A13" value="SP">Simple Past: knew</label>
  </div>

  <!-- A14: today finished vs unfinished -->
  <div class="q" data-id="A14" data-type="mc" data-points="1" data-correct="PP"
       data-explain="Con â€œtodayâ€ si puÃ² usare PP se il periodo non Ã¨ finito (oggi non Ã¨ finito).">
    <div class="qtitle">A14) Tempo corretto</div>
    <div class="prompt">I ____ (drink) two coffees today.</div>
    <label><input type="radio" name="A14" value="PP">Present Perfect: have drunk</label>
    <label><input type="radio" name="A14" value="SP">Simple Past: drank</label>
  </div>

  <!-- A15: already -->
  <div class="q" data-id="A15" data-type="mc" data-points="1" data-correct="PP"
       data-explain="â€œalreadyâ€ si usa spesso con Present Perfect per dire che Ã¨ successo prima del previsto.">
    <div class="qtitle">A15) Tempo corretto</div>
    <div class="prompt">She ____ (already / finish) her homework.</div>
    <label><input type="radio" name="A15" value="PP">Present Perfect: has already finished</label>
    <label><input type="radio" name="A15" value="SP">Simple Past: already finished</label>
  </div>

  <!-- A16: just -->
  <div class="q" data-id="A16" data-type="mc" data-points="1" data-correct="PP"
       data-explain="â€œjustâ€ spesso con Present Perfect: azione appena successa (molto recente).">
    <div class="qtitle">A16) Tempo corretto</div>
    <div class="prompt">We ____ (just / arrive).</div>
    <label><input type="radio" name="A16" value="PP">Present Perfect: have just arrived</label>
    <label><input type="radio" name="A16" value="SP">Simple Past: just arrived</label>
  </div>

  <!-- A17: yet in questions -->
  <div class="q" data-id="A17" data-type="mc" data-points="1" data-correct="PP"
       data-explain="â€œyetâ€ nelle domande/negative spesso con Present Perfect (fino ad ora).">
    <div class="qtitle">A17) Tempo corretto</div>
    <div class="prompt">____ you ____ (do) your homework yet?</div>
    <label><input type="radio" name="A17" value="PP">Have â€¦ done</label>
    <label><input type="radio" name="A17" value="SP">Did â€¦ do</label>
  </div>

  <!-- A18: never without not -->
  <div class="q" data-id="A18" data-type="mc" data-points="1" data-correct="GOOD"
       data-explain="Con â€œneverâ€ non si usa â€œnotâ€: *I have neverâ€¦* (non *havenâ€™t never*).">
    <div class="qtitle">A18) Frase corretta</div>
    <div class="prompt">Scegli la frase corretta:</div>
    <label><input type="radio" name="A18" value="BAD">I havenâ€™t never been to Spain.</label>
    <label><input type="radio" name="A18" value="GOOD">I have never been to Spain.</label>
  </div>

  <!-- A19: been to vs been in -->
  <div class="q" data-id="A19" data-type="mc" data-points="1" data-correct="TO"
       data-explain="â€œbeen toâ€ = ci sono stato (esperienza/visita). â€œbeen inâ€ = ci sono stato dentro/nel luogo (meno tipico per la scuola media).">
    <div class="qtitle">A19) Scelta corretta</div>
    <div class="prompt">I have been ____ London.</div>
    <label><input type="radio" name="A19" value="TO">to</label>
    <label><input type="radio" name="A19" value="IN">in</label>
  </div>

  <!-- A20: specific time blocks PP -->
  <div class="q" data-id="A20" data-type="mc" data-points="1" data-correct="SP"
       data-explain="â€œyesterdayâ€ Ã¨ tempo finito: si usa Simple Past, non Present Perfect.">
    <div class="qtitle">A20) Tempo corretto</div>
    <div class="prompt">We ____ (see) that film yesterday.</div>
    <label><input type="radio" name="A20" value="PP">have seen</label>
    <label><input type="radio" name="A20" value="SP">saw</label>
  </div>

  <!-- A21: question about time => past simple -->
  <div class="q" data-id="A21" data-type="mc" data-points="1" data-correct="SP"
       data-explain="Se chiedi â€œWhenâ€¦?â€ di solito vai su Simple Past (tempo preciso).">
    <div class="qtitle">A21) Tempo corretto</div>
    <div class="prompt">When ____ you ____ (start) playing football?</div>
    <label><input type="radio" name="A21" value="PP">have â€¦ started</label>
    <label><input type="radio" name="A21" value="SP">did â€¦ start</label>
  </div>
</section>

<!-- QUIZ B EXTRA â€” PerchÃ© -->
<section class="card" id="card-why-extra">
  <h2>Quiz B Extra â€” PerchÃ© (motivazione) <span class="pill">10 punti</span></h2>
  <p class="hint">Ora scegli il motivo giusto: (since/for, today, already/just/yet, when).</p>

  <div class="q" data-id="B13" data-type="mc" data-points="1" data-correct="SINCE"
       data-explain="Since = punto di inizio (da quando).">
    <div class="qtitle">B13) PerchÃ© in A13 si usa Present Perfect?</div>
    <div class="prompt">I have known him since 2020.</div>
    <label><input type="radio" name="B13" value="SINCE">PerchÃ© â€œsinceâ€ indica un punto di inizio.</label>
    <label><input type="radio" name="B13" value="DEF_TIME">PerchÃ© â€œsince 2020â€ Ã¨ come â€œin 2020â€.</label>
    <label><input type="radio" name="B13" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
  </div>

  <div class="q" data-id="B14" data-type="mc" data-points="1" data-correct="UNFINISHED"
       data-explain="Today/this week possono essere tempi non finiti.">
    <div class="qtitle">B14) PerchÃ© in A14 puÃ² andare il Present Perfect?</div>
    <div class="prompt">I have drunk two coffees today.</div>
    <label><input type="radio" name="B14" value="UNFINISHED">PerchÃ© â€œtodayâ€ puÃ² non essere finito.</label>
    <label><input type="radio" name="B14" value="DEF_TIME">PerchÃ© â€œtodayâ€ Ã¨ sempre finito.</label>
    <label><input type="radio" name="B14" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
  </div>

  <div class="q" data-id="B15" data-type="mc" data-points="1" data-correct="ALREADY"
       data-explain="Already: spesso con Present Perfect, per dire â€œgiÃ â€.">
    <div class="qtitle">B15) PerchÃ© in A15 si usa Present Perfect?</div>
    <div class="prompt">She has already finished her homework.</div>
    <label><input type="radio" name="B15" value="ALREADY">PerchÃ© câ€™Ã¨ â€œalreadyâ€ (giÃ ).</label>
    <label><input type="radio" name="B15" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito/preciso.</label>
    <label><input type="radio" name="B15" value="WHEN">PerchÃ© câ€™Ã¨ â€œwhenâ€.</label>
  </div>

  <div class="q" data-id="B16" data-type="mc" data-points="1" data-correct="JUST"
       data-explain="Just: azione appena successa, spesso con Present Perfect.">
    <div class="qtitle">B16) PerchÃ© in A16 si usa Present Perfect?</div>
    <div class="prompt">We have just arrived.</div>
    <label><input type="radio" name="B16" value="JUST">PerchÃ© câ€™Ã¨ â€œjustâ€ (appena).</label>
    <label><input type="radio" name="B16" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito/preciso.</label>
    <label><input type="radio" name="B16" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
  </div>

  <div class="q" data-id="B17" data-type="mc" data-points="1" data-correct="YET"
       data-explain="Yet: spesso in domande/negative con Present Perfect (fino ad ora).">
    <div class="qtitle">B17) PerchÃ© in A17 si usa Present Perfect?</div>
    <div class="prompt">Have you done your homework yet?</div>
    <label><input type="radio" name="B17" value="YET">PerchÃ© câ€™Ã¨ â€œyetâ€ (fino ad ora).</label>
    <label><input type="radio" name="B17" value="DEF_TIME">PerchÃ© câ€™Ã¨ un tempo finito/preciso.</label>
    <label><input type="radio" name="B17" value="RESULT_NOW">PerchÃ© conta il risultato nel presente.</label>
  </div>

  <div class="q" data-id="B18" data-type="mc" data-points="1" data-correct="NEVER_RULE"
       data-explain="Never non vuole â€œnotâ€: non si dice *havenâ€™t never*.">
    <div class="qtitle">B18) PerchÃ© A18 (GOOD) Ã¨ corretta?</div>
    <div class="prompt">I have never been to Spain.</div>
    <label><input type="radio" name="B18" value="NEVER_RULE">PerchÃ© â€œneverâ€ si usa senza â€œnotâ€.</label>
    <label><input type="radio" name="B18" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
    <label><input type="radio" name="B18" value="UNFINISHED">PerchÃ© il tempo non Ã¨ finito.</label>
  </div>

  <div class="q" data-id="B19" data-type="mc" data-points="1" data-correct="TO_EXP"
       data-explain="Been to: esperienza/visita.">
    <div class="qtitle">B19) PerchÃ© in A19 si usa â€œtoâ€?</div>
    <div class="prompt">I have been to London.</div>
    <label><input type="radio" name="B19" value="TO_EXP">PerchÃ© â€œbeen toâ€ indica esperienza/visita.</label>
    <label><input type="radio" name="B19" value="DEF_TIME">PerchÃ© â€œtoâ€ indica un tempo finito.</label>
    <label><input type="radio" name="B19" value="AGO">PerchÃ© câ€™Ã¨ â€œagoâ€.</label>
  </div>

  <div class="q" data-id="B20" data-type="mc" data-points="1" data-correct="YESTERDAY"
       data-explain="Yesterday = tempo finito â†’ Simple Past.">
    <div class="qtitle">B20) PerchÃ© in A20 si usa Simple Past?</div>
    <div class="prompt">We saw that film yesterday.</div>
    <label><input type="radio" name="B20" value="YESTERDAY">PerchÃ© â€œyesterdayâ€ Ã¨ un tempo finito/preciso.</label>
    <label><input type="radio" name="B20" value="LIFE_EXP">PerchÃ© Ã¨ unâ€™esperienza di vita senza quando.</label>
    <label><input type="radio" name="B20" value="UNFINISHED">PerchÃ© â€œyesterdayâ€ non Ã¨ finito.</label>
  </div>

  <div class="q" data-id="B21" data-type="mc" data-points="1" data-correct="WHEN_RULE"
       data-explain="Quando chiedi â€œWhenâ€¦?â€ stai chiedendo un momento preciso â†’ Past Simple.">
    <div class="qtitle">B21) PerchÃ© in A21 si usa Simple Past?</div>
    <div class="prompt">When did you start playing football?</div>
    <label><input type="radio" name="B21" value="WHEN_RULE">PerchÃ© â€œWhenâ€¦?â€ chiede un momento preciso.</label>
    <label><input type="radio" name="B21" value="RESULT_NOW">PerchÃ© conta il risultato nel presente.</label>
    <label><input type="radio" name="B21" value="UNFINISHED">PerchÃ© il tempo non Ã¨ finito.</label>
  </div>
</section>
<!-- ========== FINE EXTRA DOMANDE ========== -->

  
  <!-- RECAP ERRORI -->
  <section class="card" id="card-recap">
    <h2>Recap errori da ripassare <span class="pill">si aggiorna da solo</span></h2>
    <p class="hint">Qui compaiono solo le domande sbagliate, con la spiegazione (cosÃ¬ ripassi piÃ¹ veloce).</p>
    <ul class="recapList" id="recapList"></ul>
    <div class="feedback warn" id="recapEmpty" style="display:none">
      Nessun errore al momento. Continua cosÃ¬ ğŸ’ª
    </div>
  </section>

</main>

<script>
  function norm(s){
    return (s || "").toString().trim().toLowerCase().replace(/\s+/g, " ");
  }

  const allQuestions = Array.from(document.querySelectorAll(".q"));
  const scoreEl = document.getElementById("score");
  const totalEl = document.getElementById("total");
  const answeredEl = document.getElementById("answered");
  const qcountEl = document.getElementById("qcount");
  const resetBtn = document.getElementById("resetBtn");
  const checkAllBtn = document.getElementById("checkAllBtn");
  const recapList = document.getElementById("recapList");
  const recapEmpty = document.getElementById("recapEmpty");

  const totalPoints = allQuestions.reduce((acc, q) => acc + Number(q.dataset.points || 0), 0);
  totalEl.textContent = totalPoints;
  qcountEl.textContent = allQuestions.length;

  // Stato: per ogni domanda: { answered, earned, picked, ok, correct, explain }
  const state = {};
  for(const q of allQuestions){
    const id = q.dataset.id || Math.random().toString(16).slice(2);
    q.dataset.id = id;
    state[id] = { answered:false, earned:0, picked:null, ok:null, correct:q.dataset.correct, explain:q.dataset.explain, points:Number(q.dataset.points||0) };
  }

  function setFeedback(q, kind, html){
    let fb = q.querySelector(".feedback.dynamic");
    if(!fb){
      fb = document.createElement("div");
      fb.className = "feedback dynamic";
      q.appendChild(fb);
    }
    fb.classList.remove("ok","bad","warn");
    fb.classList.add(kind);
    fb.innerHTML = html;
  }

  function checkQuestion(q, showWarningsIfEmpty=false){
    const id = q.dataset.id;
    const points = Number(q.dataset.points || 0);

    const radios = Array.from(q.querySelectorAll('input[type="radio"]'));
    const picked = radios.find(r => r.checked)?.value;

    if(!picked){
      state[id] = { ...state[id], answered:false, earned:0, picked:null, ok:null };
      if(showWarningsIfEmpty){
        setFeedback(q, "warn", "â³ Scegli una risposta.");
      }
      return;
    }

    const correct = q.dataset.correct;
    const ok = norm(picked) === norm(correct);
    const explain = q.dataset.explain ? `<div class="small">PerchÃ©: ${q.dataset.explain}</div>` : "";

    setFeedback(q, ok ? "ok" : "bad",
      (ok ? "âœ… Giusto!" : `âŒ Sbagliato. Risposta corretta: <b>${correct}</b>.`) + explain
    );

    state[id] = {
      ...state[id],
      answered:true,
      earned: ok ? points : 0,
      picked,
      ok,
      correct,
      explain: q.dataset.explain || "",
      points
    };
  }

  function updateHeaderScore(){
    let earned = 0;
    let answered = 0;

    for(const id in state){
      earned += state[id].earned || 0;
      if(state[id].answered) answered += 1;
    }

    scoreEl.textContent = earned;
    answeredEl.textContent = answered;
  }

  function updateRecap(){
    recapList.innerHTML = "";

    const wrong = Object.entries(state)
      .filter(([_, s]) => s.answered && s.ok === false)
      .map(([id, s]) => ({ id, ...s }));

    if(wrong.length === 0){
      recapEmpty.style.display = "block";
      return;
    }
    recapEmpty.style.display = "none";

    for(const w of wrong){
      const li = document.createElement("li");
      li.className = "recapItem";

      li.innerHTML = `
        <div><b>${w.id}</b> â€” Hai scelto: <b>${w.picked}</b> | Corretto: <b>${w.correct}</b></div>
        <div class="small">Spiegazione: ${w.explain || "â€”"}</div>
      `;
      recapList.appendChild(li);
    }
  }

  function recalcAll(){
    // ricontrolla tutto (utile se uno cambia piÃ¹ risposte)
    for(const q of allQuestions){
      checkQuestion(q, true);
    }
    updateHeaderScore();
    updateRecap();
  }

  function resetAll(){
    // reset radios
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    // remove feedback
    document.querySelectorAll(".feedback.dynamic").forEach(el => el.remove());
    // reset state
    for(const id in state){
      state[id].answered = false;
      state[id].earned = 0;
      state[id].picked = null;
      state[id].ok = null;
    }
    updateHeaderScore();
    updateRecap();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // IMMEDIATE CHECK: on change of any radio, check that single question + update score + recap
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener("change", (e) => {
      const q = e.target.closest(".q");
      checkQuestion(q, true);     // immediate feedback + explanation
      updateHeaderScore();        // immediate score update
      updateRecap();              // immediate recap update
    });
  });

  // Buttons
  resetBtn.addEventListener("click", resetAll);
  checkAllBtn.addEventListener("click", recalcAll);

  // Init recap empty
  updateHeaderScore();
  updateRecap();
</script>

</body>
</html>
