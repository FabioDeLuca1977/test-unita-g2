<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Unit√† G2 - TURBINE IDRAULICHE</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px; }
        .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid #11998e; }
        .header h1 { color: #11998e; font-size: 2em; margin-bottom: 10px; }
        .section { margin-bottom: 40px; padding: 25px; background: #f8f9fa; border-radius: 15px; border-left: 5px solid #11998e; }
        .section-title { color: #0d7f6f; font-size: 1.3em; margin-bottom: 20px; font-weight: bold; }
        .question { margin-bottom: 25px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .question-text { font-weight: 600; color: #333; margin-bottom: 15px; font-size: 1.05em; }
        .option { padding: 12px 15px; margin: 8px 0; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; }
        .option:hover { border-color: #11998e; background: #e8f9f5; transform: translateX(5px); }
        .option input[type="radio"] { margin-right: 10px; cursor: pointer; }
        .tf-buttons { display: flex; gap: 15px; }
        .tf-button { flex: 1; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; text-align: center; font-weight: 600; transition: all 0.3s ease; background: white; }
        .tf-button:hover { border-color: #11998e; background: #e8f9f5; }
        .tf-button.selected { background: #11998e; color: white; border-color: #11998e; }
        .sortable-list { min-height: 50px; }
        .sortable-item { padding: 15px; margin: 10px 0; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: move; transition: all 0.3s ease; display: flex; align-items: center; gap: 10px; }
        .sortable-item:hover { border-color: #11998e; box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3); }
        .sortable-item.dragging { opacity: 0.5; }
        .drag-handle { font-size: 1.2em; color: #999; }
        .verify-btn { padding: 12px 25px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 15px; }
        .verify-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4); }
        .submit-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 12px; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }
        .result { margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border-radius: 15px; text-align: center; font-size: 1.3em; font-weight: bold; display: none; box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4); }
        .feedback { margin-top: 10px; padding: 12px; border-radius: 8px; font-weight: 600; display: none; }
        .feedback.correct { background: #d4edda; color: #155724; border: 2px solid #c3e6cb; display: block; }
        .feedback.incorrect { background: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; display: block; }
        .explanation { margin-top: 8px; font-size: 0.95em; font-weight: normal; line-height: 1.5; }
        .instruction { background: #e3f2fd; padding: 12px; border-radius: 8px; margin-bottom: 15px; color: #1565c0; font-style: italic; }
        select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; cursor: pointer; width: 100%; background: white; }
        select:focus { outline: none; border-color: #11998e; }
        @media (max-width: 768px) { .container { padding: 20px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíß TEST UNIT√Ä G2 - TURBINE IDRAULICHE</h1>
            <p style="color: #666; margin-top: 10px;">Turbine Pelton, Francis e Kaplan</p>
        </div>

        <div class="section">
            <div class="section-title">üîπ Parte 1 ‚Äì Scelta multipla</div>
            
            <div class="question">
                <div class="question-text">1Ô∏è‚É£ Le turbine idrauliche sono:</div>
                <label class="option"><input type="radio" name="q1" value="a" onchange="checkQuestion('q1')">Macchine motrici di grande potenza installate nelle centrali idroelettriche</label>
                <label class="option"><input type="radio" name="q1" value="b" onchange="checkQuestion('q1')">Macchine operatrici che sollevano acqua</label>
                <label class="option"><input type="radio" name="q1" value="c" onchange="checkQuestion('q1')">Piccoli motori a vapore</label>
                <label class="option"><input type="radio" name="q1" value="d" onchange="checkQuestion('q1')">Pompe per l'irrigazione</label>
                <div class="feedback" id="feedback-q1"></div>
            </div>

            <div class="question">
                <div class="question-text">2Ô∏è‚É£ Lo scopo principale di una turbina idraulica √®:</div>
                <label class="option"><input type="radio" name="q2" value="a" onchange="checkQuestion('q2')">Tenere in rotazione gli alternatori per produrre energia elettrica</label>
                <label class="option"><input type="radio" name="q2" value="b" onchange="checkQuestion('q2')">Muovere il pistone di un motore a scoppio</label>
                <label class="option"><input type="radio" name="q2" value="c" onchange="checkQuestion('q2')">Azionare le vele di un mulino</label>
                <label class="option"><input type="radio" name="q2" value="d" onchange="checkQuestion('q2')">Regolare la pressione del vapore</label>
                <div class="feedback" id="feedback-q2"></div>
            </div>

            <div class="question">
                <div class="question-text">3Ô∏è‚É£ Tutte le turbine hanno in comune:</div>
                <label class="option"><input type="radio" name="q3" value="a" onchange="checkQuestion('q3')">Distributore, ugello e girante</label>
                <label class="option"><input type="radio" name="q3" value="b" onchange="checkQuestion('q3')">Cilindro, stantuffo e biella</label>
                <label class="option"><input type="radio" name="q3" value="c" onchange="checkQuestion('q3')">Volano, albero motore e chiusa</label>
                <label class="option"><input type="radio" name="q3" value="d" onchange="checkQuestion('q3')">Ruota, pala e timone</label>
                <div class="feedback" id="feedback-q3"></div>
            </div>

            <div class="question">
                <div class="question-text">4Ô∏è‚É£ L'ugello serve a:</div>
                <label class="option"><input type="radio" name="q4" value="a" onchange="checkQuestion('q4')">Far uscire l'acqua ad alta velocit√† riducendo la sezione del tubo</label>
                <label class="option"><input type="radio" name="q4" value="b" onchange="checkQuestion('q4')">Far entrare aria nel tubo</label>
                <label class="option"><input type="radio" name="q4" value="c" onchange="checkQuestion('q4')">Bloccare il flusso d'acqua</label>
                <label class="option"><input type="radio" name="q4" value="d" onchange="checkQuestion('q4')">Sollevare il livello dell'acqua</label>
                <div class="feedback" id="feedback-q4"></div>
            </div>

            <div class="question">
                <div class="question-text">5Ô∏è‚É£ La girante √®:</div>
                <label class="option"><input type="radio" name="q5" value="a" onchange="checkQuestion('q5')">Una ruota con pale messa in rotazione dal getto d'acqua</label>
                <label class="option"><input type="radio" name="q5" value="b" onchange="checkQuestion('q5')">Un condotto fisso per l'acqua</label>
                <label class="option"><input type="radio" name="q5" value="c" onchange="checkQuestion('q5')">Una valvola di sicurezza</label>
                <label class="option"><input type="radio" name="q5" value="d" onchange="checkQuestion('q5')">Una caldaia di alimentazione</label>
                <div class="feedback" id="feedback-q5"></div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">üîπ Parte 2 ‚Äì Vero o Falso</div>

            <div class="question">
                <div class="question-text">1Ô∏è‚É£ Le turbine idrauliche vengono usate nelle centrali idroelettriche.</div>
                <input type="hidden" id="tf1" value="">
                <div class="tf-buttons">
                    <div class="tf-button" onclick="selectTF('tf1', 'vero')">‚úÖ VERO</div>
                    <div class="tf-button" onclick="selectTF('tf1', 'falso')">‚ùå FALSO</div>
                </div>
                <div class="feedback" id="feedback-tf1"></div>
            </div>

            <div class="question">
                <div class="question-text">2Ô∏è‚É£ Quando si riduce la sezione del tubo, la velocit√† dell'acqua diminuisce.</div>
                <input type="hidden" id="tf2" value="">
                <div class="tf-buttons">
                    <div class="tf-button" onclick="selectTF('tf2', 'vero')">‚úÖ VERO</div>
                    <div class="tf-button" onclick="selectTF('tf2', 'falso')">‚ùå FALSO</div>
                </div>
                <div class="feedback" id="feedback-tf2"></div>
            </div>

            <div class="question">
                <div class="question-text">3Ô∏è‚É£ Il distributore √® un tubo fisso in cui scorre acqua ad alta pressione.</div>
                <input type="hidden" id="tf3" value="">
                <div class="tf-buttons">
                    <div class="tf-button" onclick="selectTF('tf3', 'vero')">‚úÖ VERO</div>
                    <div class="tf-button" onclick="selectTF('tf3', 'falso')">‚ùå FALSO</div>
                </div>
                <div class="feedback" id="feedback-tf3"></div>
            </div>

            <div class="question">
                <div class="question-text">4Ô∏è‚É£ Tutte le turbine funzionano immerse nell'acqua.</div>
                <input type="hidden" id="tf4" value="">
                <div class="tf-buttons">
                    <div class="tf-button" onclick="selectTF('tf4', 'vero')">‚úÖ VERO</div>
                    <div class="tf-button" onclick="selectTF('tf4', 'falso')">‚ùå FALSO</div>
                </div>
                <div class="feedback" id="feedback-tf4"></div>
            </div>

            <div class="question">
                <div class="question-text">5Ô∏è‚É£ L'ugello √® la parte mobile della turbina.</div>
                <input type="hidden" id="tf5" value="">
                <div class="tf-buttons">
                    <div class="tf-button" onclick="selectTF('tf5', 'vero')">‚úÖ VERO</div>
                    <div class="tf-button" onclick="selectTF('tf5', 'falso')">‚ùå FALSO</div>
                </div>
                <div class="feedback" id="feedback-tf5"></div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">üîπ Parte 3 ‚Äì Associazioni</div>
            <div class="instruction">üí° Collega ogni turbina alle sue caratteristiche</div>
            
            <div class="question">
                <div class="question-text">Turbina Pelton ‚Üí</div>
                <select id="match1">
                    <option value="">-- Seleziona --</option>
                    <option value="pelton">üöø Per grandi dislivelli (fino a 2000 m); unica non immersa, con cucchiai</option>
                    <option value="francis">‚öôÔ∏è Per dislivelli intermedi (30‚Äì400 m); pale svergolate ad anello</option>
                    <option value="kaplan">üåä Per piccoli dislivelli (fino a 50 m); pale orientabili a elica</option>
                </select>
                <div class="feedback" id="feedback-match1"></div>
            </div>

            <div class="question">
                <div class="question-text">Turbina Francis ‚Üí</div>
                <select id="match2">
                    <option value="">-- Seleziona --</option>
                    <option value="pelton">üöø Per grandi dislivelli (fino a 2000 m); unica non immersa, con cucchiai</option>
                    <option value="francis">‚öôÔ∏è Per dislivelli intermedi (30‚Äì400 m); pale svergolate ad anello</option>
                    <option value="kaplan">üåä Per piccoli dislivelli (fino a 50 m); pale orientabili a elica</option>
                </select>
                <div class="feedback" id="feedback-match2"></div>
            </div>

            <div class="question">
                <div class="question-text">Turbina Kaplan ‚Üí</div>
                <select id="match3">
                    <option value="">-- Seleziona --</option>
                    <option value="pelton">üöø Per grandi dislivelli (fino a 2000 m); unica non immersa, con cucchiai</option>
                    <option value="francis">‚öôÔ∏è Per dislivelli intermedi (30‚Äì400 m); pale svergolate ad anello</option>
                    <option value="kaplan">üåä Per piccoli dislivelli (fino a 50 m); pale orientabili a elica</option>
                </select>
                <div class="feedback" id="feedback-match3"></div>
            </div>

            <button class="verify-btn" onclick="checkMatches()">‚úì Verifica Associazioni</button>
        </div>

        <div class="section">
            <div class="section-title">üîπ Parte 4 ‚Äì Ordinamento Drag & Drop</div>
            <div class="instruction">üí° Ordina le fasi di funzionamento della turbina</div>

            <div class="sortable-list" id="sortable">
                <div class="sortable-item" draggable="true"><span class="drag-handle">‚ò∞</span><span>L'acqua esce attraverso il condotto di scarico</span></div>
                <div class="sortable-item" draggable="true"><span class="drag-handle">‚ò∞</span><span>Colpisce la girante e la mette in rotazione</span></div>
                <div class="sortable-item" draggable="true"><span class="drag-handle">‚ò∞</span><span>Passa attraverso l'ugello e aumenta la velocit√†</span></div>
                <div class="sortable-item" draggable="true"><span class="drag-handle">‚ò∞</span><span>L'acqua entra nel distributore ad alta pressione</span></div>
            </div>
            <div class="feedback" id="feedback-order"></div>
            <button class="verify-btn" onclick="checkOrder()">‚úì Verifica Ordine</button>
        </div>

        <div class="section">
            <div class="section-title">üîπ Parte 5 ‚Äì Tipi di Turbine</div>
            
            <div class="question">
                <div class="question-text">1Ô∏è‚É£ La turbina Pelton √® usata per:</div>
                <label class="option"><input type="radio" name="q6" value="a" onchange="checkQuestion('q6')">Grandi dislivelli e piccole portate</label>
                <label class="option"><input type="radio" name="q6" value="b" onchange="checkQuestion('q6')">Piccoli dislivelli e grandi portate</label>
                <label class="option"><input type="radio" name="q6" value="c" onchange="checkQuestion('q6')">Solo in pianura</label>
                <label class="option"><input type="radio" name="q6" value="d" onchange="checkQuestion('q6')">Solo in mare</label>
                <div class="feedback" id="feedback-q6"></div>
            </div>

            <div class="question">
                <div class="question-text">2Ô∏è‚É£ La turbina Francis ha pale:</div>
                <label class="option"><input type="radio" name="q7" value="a" onchange="checkQuestion('q7')">Svergolate disposte ad anello</label>
                <label class="option"><input type="radio" name="q7" value="b" onchange="checkQuestion('q7')">A forma di cucchiaio</label>
                <label class="option"><input type="radio" name="q7" value="c" onchange="checkQuestion('q7')">A elica orientabili</label>
                <label class="option"><input type="radio" name="q7" value="d" onchange="checkQuestion('q7')">Piatte e verticali</label>
                <div class="feedback" id="feedback-q7"></div>
            </div>

            <div class="question">
                <div class="question-text">3Ô∏è‚É£ La turbina Kaplan √® ideale per:</div>
                <label class="option"><input type="radio" name="q8" value="a" onchange="checkQuestion('q8')">Piccoli dislivelli ma grandi portate d'acqua</label>
                <label class="option"><input type="radio" name="q8" value="b" onchange="checkQuestion('q8')">Grandi dislivelli</label>
                <label class="option"><input type="radio" name="q8" value="c" onchange="checkQuestion('q8')">Acqua salata</label>
                <label class="option"><input type="radio" name="q8" value="d" onchange="checkQuestion('q8')">Vapore ad alta pressione</label>
                <div class="feedback" id="feedback-q8"></div>
            </div>

            <div class="question">
                <div class="question-text">4Ô∏è‚É£ L'unica turbina che NON lavora immersa nell'acqua √®:</div>
                <label class="option"><input type="radio" name="q9" value="a" onchange="checkQuestion('q9')">La turbina Pelton</label>
                <label class="option"><input type="radio" name="q9" value="b" onchange="checkQuestion('q9')">La turbina Francis</label>
                <label class="option"><input type="radio" name="q9" value="c" onchange="checkQuestion('q9')">La turbina Kaplan</label>
                <label class="option"><input type="radio" name="q9" value="d" onchange="checkQuestion('q9')">Tutte lavorano immerse</label>
                <div class="feedback" id="feedback-q9"></div>
            </div>

            <div class="question">
                <div class="question-text">5Ô∏è‚É£ I cucchiai sono caratteristici di:</div>
                <label class="option"><input type="radio" name="q10" value="a" onchange="checkQuestion('q10')">Turbina Pelton</label>
                <label class="option"><input type="radio" name="q10" value="b" onchange="checkQuestion('q10')">Turbina Francis</label>
                <label class="option"><input type="radio" name="q10" value="c" onchange="checkQuestion('q10')">Turbina Kaplan</label>
                <label class="option"><input type="radio" name="q10" value="d" onchange="checkQuestion('q10')">Mulini a vento</label>
                <div class="feedback" id="feedback-q10"></div>
            </div>
        </div>

        <button class="submit-btn" onclick="showFinalScore()">üìä MOSTRA PUNTEGGIO FINALE</button>
        <div class="result" id="result"></div>
    </div>

    <script>
        const correctAnswers = {
            q1: { answer: 'a', explanation: 'Le turbine idrauliche sono potenti macchine motrici installate nelle centrali idroelettriche per trasformare l\'energia dell\'acqua in energia elettrica.' },
            q2: { answer: 'a', explanation: 'Le turbine idrauliche fanno girare gli alternatori, che convertono l\'energia meccanica rotazionale in energia elettrica.' },
            q3: { answer: 'a', explanation: 'Tutte le turbine hanno tre componenti fondamentali: distributore (porta l\'acqua), ugello (accelera l\'acqua), girante (ruota con pale).' },
            q4: { answer: 'a', explanation: 'L\'ugello riduce la sezione del tubo facendo aumentare la velocit√† dell\'acqua (principio di Bernoulli), trasformando pressione in velocit√†.' },
            q5: { answer: 'a', explanation: 'La girante √® la parte mobile della turbina: una ruota con pale che viene messa in rotazione dall\'energia cinetica dell\'acqua.' },
            tf1: { answer: 'vero', explanation: 'Le turbine idrauliche sono il cuore delle centrali idroelettriche, sfruttando l\'energia dell\'acqua per produrre elettricit√†.' },
            tf2: { answer: 'falso', explanation: 'Quando la sezione del tubo diminuisce, la velocit√† dell\'acqua AUMENTA per il principio di continuit√† (portata costante = velocit√† √ó sezione).' },
            tf3: { answer: 'vero', explanation: 'Il distributore √® un condotto fisso che porta acqua ad alta pressione dalla diga verso l\'ugello della turbina.' },
            tf4: { answer: 'falso', explanation: 'La turbina Pelton NON lavora immersa: il getto d\'acqua colpisce i cucchiai all\'aria. Solo Francis e Kaplan lavorano sommerse.' },
            tf5: { answer: 'falso', explanation: 'L\'ugello √® FISSO. La parte mobile √® la girante (ruota con pale) che viene messa in rotazione dall\'acqua.' },
            match1: { answer: 'pelton', explanation: 'La Pelton √® per grandi altezze (fino a 2000 m) e piccole portate. Ha cucchiai e lavora all\'aria, non sommersa.' },
            match2: { answer: 'francis', explanation: 'La Francis √® per dislivelli intermedi (30-400 m). Ha pale svergolate disposte ad anello e lavora completamente immersa.' },
            match3: { answer: 'kaplan', explanation: 'La Kaplan √® per piccoli dislivelli (fino a 50 m) ma grandi portate. Ha pale a elica orientabili per regolare il flusso.' },
            order: { 
                answer: ['L\'acqua entra nel distributore ad alta pressione', 'Passa attraverso l\'ugello e aumenta la velocit√†', 'Colpisce la girante e la mette in rotazione', 'L\'acqua esce attraverso il condotto di scarico'],
                explanation: 'Questo √® il ciclo completo: l\'acqua dalla diga entra nel distributore sotto pressione, passa nell\'ugello dove accelera, colpisce le pale della girante facendola girare, ed esce dallo scarico verso il fiume.'
            },
            q6: { answer: 'a', explanation: 'La Pelton sfrutta grandi dislivelli (energia potenziale) con portate relativamente piccole, tipica delle zone montane.' },
            q7: { answer: 'a', explanation: 'La Francis ha pale svergolate (curve tridimensionali) disposte ad anello attorno all\'asse, ottimizzate per dislivelli medi.' },
            q8: { answer: 'a', explanation: 'La Kaplan √® perfetta per fiumi con poco dislivello ma molta acqua. Le pale orientabili regolano il flusso variabile.' },
            q9: { answer: 'a', explanation: 'Solo la Pelton lavora all\'aria: il getto colpisce i cucchiai dall\'esterno. Francis e Kaplan sono completamente sommerse.' },
            q10: { answer: 'a', explanation: 'I cucchiai a doppia cavit√† sono tipici della Pelton: dividono il getto in due permettendo di sfruttare meglio l\'energia.' }
        };

        let score = 0;
        let answeredQuestions = new Set();

        function checkQuestion(qId) {
            const sel = document.querySelector(`input[name="${qId}"]:checked`);
            const fb = document.getElementById(`feedback-${qId}`);
            if (!sel) return;
            const ok = sel.value === correctAnswers[qId].answer;
            fb.className = ok ? 'feedback correct' : 'feedback incorrect';
            fb.innerHTML = (ok ? '‚úÖ <strong>Corretto!</strong>' : '‚ùå <strong>Risposta errata</strong>') + `<div class="explanation">${correctAnswers[qId].explanation}</div>`;
            if (!answeredQuestions.has(qId)) { if(ok) score++; answeredQuestions.add(qId); }
        }

        function selectTF(id, val) {
            document.getElementById(id).value = val;
            const btns = event.target.parentElement.querySelectorAll('.tf-button');
            btns.forEach(b => b.classList.remove('selected'));
            event.target.classList.add('selected');
            const fb = document.getElementById(`feedback-${id}`);
            const ok = val === correctAnswers[id].answer;
            fb.className = ok ? 'feedback correct' : 'feedback incorrect';
            fb.innerHTML = (ok ? '‚úÖ <strong>Corretto!</strong>' : '‚ùå <strong>Risposta errata</strong>') + `<div class="explanation">${correctAnswers[id].explanation}</div>`;
            if (!answeredQuestions.has(id)) { if(ok) score++; answeredQuestions.add(id); }
        }

        function checkMatches() {
            for(let i=1; i<=3; i++) {
                const sel = document.getElementById(`match${i}`).value;
                const fb = document.getElementById(`feedback-match${i}`);
                const qId = `match${i}`;
                if (!sel) { fb.className = 'feedback incorrect'; fb.innerHTML = '‚ö†Ô∏è <strong>Nessuna risposta</strong>'; continue; }
                const ok = sel === correctAnswers[qId].answer;
                fb.className = ok ? 'feedback correct' : 'feedback incorrect';
                fb.innerHTML = (ok ? '‚úÖ <strong>Corretto!</strong>' : '‚ùå <strong>Risposta errata</strong>') + `<div class="explanation">${correctAnswers[qId].explanation}</div>`;
                if (!answeredQuestions.has(qId)) { if(ok) score++; answeredQuestions.add(qId); }
            }
        }

        let draggedElement = null;
        const sortableList = document.getElementById('sortable');
        const sortableItems = sortableList.querySelectorAll('.sortable-item');
        sortableItems.forEach(item => {
            item.addEventListener('dragstart', function(e) { draggedElement = this; setTimeout(() => this.classList.add('dragging'), 0); });
            item.addEventListener('dragend', function() { setTimeout(() => this.classList.remove('dragging'), 0); draggedElement = null; });
            item.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(sortableList, e.clientY);
                if (afterElement == null) { sortableList.appendChild(draggedElement); }
                else { sortableList.insertBefore(draggedElement, afterElement); }
            });
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.sortable-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) { return { offset: offset, element: child }; }
                else { return closest; }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function checkOrder() {
            const sorted = Array.from(sortableList.children).map(item => item.querySelector('span:last-child').textContent);
            const fb = document.getElementById('feedback-order');
            const qId = 'order';
            let ok = true;
            for (let i = 0; i < sorted.length; i++) { if (sorted[i] !== correctAnswers.order.answer[i]) { ok = false; break; } }
            fb.className = ok ? 'feedback correct' : 'feedback incorrect';
            fb.innerHTML = ok ? `‚úÖ <strong>Ordine corretto!</strong><div class="explanation">${correctAnswers.order.explanation}</div>` :
                `‚ùå <strong>Ordine errato</strong><div class="explanation"><strong>Ordine corretto:</strong> ${correctAnswers.order.answer.join(' ‚Üí ')}<br><br>${correctAnswers.order.explanation}</div>`;
            if (!answeredQuestions.has(qId)) { if(ok) score++; answeredQuestions.add(qId); }
        }

        function showFinalScore() {
            const total = 22;
            const perc = ((score / total) * 100).toFixed(1);
            const rd = document.getElementById('result');
            let emoji = '', msg = '';
            if (perc >= 90) { emoji = 'üèÜ'; msg = 'Eccellente! Ottima conoscenza!'; }
            else if (perc >= 75) { emoji = 'üëç'; msg = 'Buono! Continua cos√¨!'; }
            else if (perc >= 60) { emoji = 'üìö'; msg = 'Sufficiente. Ripassa alcuni concetti.'; }
            else { emoji = 'üìñ'; msg = 'Da ripassare. Studia ancora un po\'.'; }
            rd.innerHTML = `${emoji} <strong>PUNTEGGIO FINALE</strong><br><div style="font-size: 2em; margin: 15px 0;">${score}/${total}</div><div style="font-size: 1.5em;">${perc}%</div><div style="font-size: 1em; margin-top: 10px; opacity: 0.95;">${msg}</div>`;
            rd.style.display = 'block';
            rd.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    </script>
</body>
</html>
